import{F as e,a,E as l,b as t,c as u,d as s,e as o,f as d,g as v,h as r,i as n,j as i,k as p,l as y,m as c,n as m,o as h,p as f,q as g,r as w,s as C,t as P,u as V,v as U}from"./el-divider-45226e98.js";import{d as I,r as _,o as D,a as S,c as k,w as b,b as R,e as N,f as Q,g as x,h as L,F as W,i as M,v as O,t as z,j as G,_ as K,k as T}from"./index-b917df06.js";const j={style:{"align-items":"center"}},q={style:{"text-align":"center"}},J={style:{"align-items":"center"}},A={style:{float:"left"}},F={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},E={key:0,style:{"text-align":"center"}},B={key:1,style:{"text-align":"center"}},H=["src"],X=I({__name:"充值续费",setup(f){const g=_("购卡"),w=_(0),C=_({"订单ID":"",PayQRCode:"",PayQRCodePNG:"",PayURL:"","订单状态":0}),P=_([]),V=_(!1),U=_(""),I=_(""),K=_(""),T=async()=>{V.value=!0;let e=U.value,t=await a(e||"",I.value,K.value);V.value=!1,1e4===t.Status&&l({type:"success",message:""===t.Msg?"充值成功":t.Msg,showClose:!0})},X=async()=>{var e;V.value=!0;let a=await s(C.value.订单ID);V.value=!1,1e4===a.Status&&(null==(e=a.Data)?void 0:e.KaName)&&(I.value=a.Data.KaName,l({type:"success",message:"卡号:"+a.Data.KaName+",已填写到输入框",showClose:!0})),l({type:"success",message:JSON.stringify(a),showClose:!0})},Y=_(0),Z=async()=>{""!==C.value.订单ID?Y.value=setInterval((()=>{3!==C.value.订单状态?s(C.value.订单ID).then((e=>{var a;1e4===e.Status?(C.value.订单状态=e.Data.Status,(null==(a=e.Data)?void 0:a.KaName)&&(I.value=e.Data.KaName)):clearInterval(Y.value),3===C.value.订单状态&&clearInterval(Y.value)})):clearInterval(Y.value)}),3e3):clearInterval(Y.value)},$=_(""),ee=_({});return D((()=>{(async()=>{let a=await e();1e4===a.Status&&(P.value=a.Data),P.value.length>0&&(w.value=P.value[0].Id)})(),(async()=>{let e=await o();if(1e4===e.Status){ee.value=e.Data;for(let e in ee.value)ee.value[e]&&($.value=e)}})()})),(e,a)=>{const s=d,o=v,f=r,_=n,D=i,K=p,Y=m,ae=h,le=y,te=c;return S(),k(te,{"label-width":"120px"},{default:b((()=>[R(s,null,{default:b((()=>[N("卡号充值")])),_:1}),Q("div",j,[R(f,{label:"充值账号",style:{width:"100%"}},{default:b((()=>[R(o,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),modelModifiers:{trim:!0},placeholder:"请输入卡号"},null,8,["modelValue"])])),_:1}),R(f,{label:"使用充值卡",style:{width:"100%"}},{default:b((()=>[R(o,{modelValue:I.value,"onUpdate:modelValue":a[1]||(a[1]=e=>I.value=e),modelModifiers:{trim:!0},placeholder:"请输入卡号"},null,8,["modelValue"])])),_:1})]),Q("div",q,[R(_,{style:{width:"15vh"},onClick:T,type:"primary"},{default:b((()=>[N("充值")])),_:1},8,["onClick"])]),R(s,null,{default:b((()=>[N("选择功能")])),_:1}),R(f,null,{default:b((()=>[R(K,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e),style:{"margin-bottom":"5px"}},{default:b((()=>[R(D,{label:"购卡"}),R(D,{label:"续费"})])),_:1},8,["modelValue"])])),_:1}),R(f,{label:"选择支付方式",style:{width:"100%"}},{default:b((()=>[R(K,{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=e=>$.value=e),style:{"align-items":"center"}},{default:b((()=>[(S(!0),x(W,null,L(Object.keys(ee.value),(e=>M((S(),k(Y,{key:e,label:e,border:""},{default:b((()=>[N(z(e),1)])),_:2},1032,["label"])),[[O,ee.value[e]]]))),128))])),_:1},8,["modelValue"])])),_:1}),Q("div",J,[M(R(f,{label:"充值账号",style:{width:"100%"}},{default:b((()=>[R(o,{modelValue:U.value,"onUpdate:modelValue":a[4]||(a[4]=e=>U.value=e),modelModifiers:{trim:!0},placeholder:"请输入卡号"},null,8,["modelValue"])])),_:1},512),[[O,"购卡"!==g.value]]),R(f,{label:"选择充值卡"},{default:b((()=>[R(le,{modelValue:w.value,"onUpdate:modelValue":a[5]||(a[5]=e=>w.value=e),placeholder:"请选择要购买的充值卡"},{default:b((()=>[(S(!0),x(W,null,L(P.value,(e=>(S(),k(ae,{key:e.Id,label:e.Name+" => ¥"+e.Money,value:e.Id},{default:b((()=>[Q("span",A,z(e.Name),1),Q("span",F,"¥"+z(e.Money),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),M(Q("div",null,[R(f,{label:"订单号",style:{width:"100%"}},{default:b((()=>[R(o,{modelValue:C.value.订单ID,"onUpdate:modelValue":a[6]||(a[6]=e=>C.value.订单ID=e),modelModifiers:{trim:!0},placeholder:"",class:"只读编辑框"},null,8,["modelValue"])])),_:1}),R(f,{label:"",style:{width:"100%"}},{default:b((()=>[R(_,{type:"primary",onClick:a[7]||(a[7]=e=>(async e=>{var a,t;if(C.value.PayURL="",C.value.PayQRCode="",C.value.订单ID="",C.value.订单状态=0,e>0){V.value=!0;let s=await u(e,$.value);V.value=!1,1e4===s.Status&&(C.value.订单ID=s.Data.OrderId,C.value.PayQRCode=s.Data.PayQRCode||"",C.value.PayQRCodePNG=(null==(a=s.Data)?void 0:a.PayQRCodePNG)||"",C.value.订单状态=1,C.value.PayURL=(null==(t=s.Data)?void 0:t.PayURL)||"",""!==C.value.PayURL&&(window.open(C.value.PayURL,"网页支付"),l({type:"success",message:"请在打开的网页支付",showClose:!0})),await Z())}})(w.value))},{default:b((()=>[N("购买卡号")])),_:1}),R(_,{onClick:X},{default:b((()=>[N("查询订单信息")])),_:1},8,["onClick"])])),_:1})],512),[[O,"购卡"===g.value]]),M(Q("div",null,[R(f,null,{default:b((()=>[R(_,{type:"primary",style:{"margin-left":"5px"},onClick:a[8]||(a[8]=e=>(async e=>{var a,u;if(C.value.PayURL="",C.value.PayQRCode="",C.value.订单ID="",C.value.订单状态=0,e>0){V.value=!0;let s=await t(U.value,e,$.value);V.value=!1,1e4===s.Status&&(C.value.订单ID=s.Data.OrderId,C.value.PayQRCode=s.Data.PayQRCode||"",C.value.PayQRCodePNG=(null==(a=s.Data)?void 0:a.PayQRCodePNG)||"",C.value.订单状态=1,C.value.PayURL=(null==(u=s.Data)?void 0:u.PayURL)||"",""!==C.value.PayURL&&(window.open(C.value.PayURL,"网页支付"),l({type:"success",message:"请在打开的网页支付",showClose:!0})),await Z())}})(w.value))},{default:b((()=>[N("购卡直充")])),_:1})])),_:1})],512),[[O,"续费"===g.value]]),Q("div",null,[C.value.订单状态>0?(S(),k(f,{key:0,label:"订单ID"},{default:b((()=>[N(z(C.value.订单ID),1)])),_:1})):G("",!0),C.value.订单状态>0?(S(),k(f,{key:1,label:"订单状态"},{default:b((()=>[N(z(1===C.value.订单状态?"等待支付":2===C.value.订单状态?"已支付待充值":3===C.value.订单状态?"充值成功":"异常状态"+C.value.订单状态.toString()),1)])),_:1})):G("",!0),1===C.value.订单状态?(S(),k(f,{key:2,label:""},{default:b((()=>[""!==C.value.PayURL?(S(),x("div",E,"请在打开的网页支付")):G("",!0),""!==C.value.PayQRCode?(S(),x("div",B,"请使用扫码支付 ")):G("",!0)])),_:1})):G("",!0),1===C.value.订单状态&&""!==C.value.PayQRCodePNG?(S(),k(f,{key:3},{default:b((()=>[Q("img",{style:{width:"200Px",height:"200Px",padding:"0",margin:"0"},src:"data:image/png;base64,"+C.value.PayQRCodePNG,alt:"请输入验证码"},null,8,H)])),_:1})):G("",!0)])])])),_:1})}}}),Y={class:"边框",style:{margin:"0% 0% 50% 0%",width:"420px"}},Z={key:0},$={class:"英数验证码",style:{height:"100%",width:"100%"}},ee=["src"],ae=K({__name:"login",setup(e){const a=_(!1),t=_("登录"),u=_({UserLogin:0,SetPassWord:0,NewUserInfo:0}),s=_(""),o=_({User:"",PassWord:"",superPassWord:"",Qq:""}),d=_({captchaId:"",captchaType:1,CaptChaValue:""}),y=()=>{"注册"===t.value&&m(),"登录"===t.value&&h(),"找回"===t.value&&I()},m=async()=>{if(u.value.NewUserInfo){if(d.value.CaptChaValue.length<4)return void l({type:"error",message:"请输入验证码",showClose:!0});C(d.value.captchaId,d.value.captchaType,d.value.CaptChaValue)}let e=o.value,a=await P(e.User,e.PassWord,"绑定信息",e.superPassWord,e.Qq);1e4===a.Status&&(t.value="登录"),l({type:"success",message:a.Msg,showClose:!0}),await L()},h=async()=>{if(u.value.UserLogin){if(d.value.CaptChaValue.length<4)return void l({type:"error",message:"请输入验证码",showClose:!0});C(d.value.captchaId,d.value.captchaType,d.value.CaptChaValue)}let e=o.value,a=await V(e.User,e.PassWord,"绑定信息","我是动态标记,随便填写","1.0.1");if(1e4===a.Status)return localStorage.setItem("UserInfo",JSON.stringify(a.Data)),localStorage.setItem("User",e.User),void T.push("/");await L()},I=async()=>{if(u.value.SetPassWord){if(d.value.CaptChaValue.length<4)return void l({type:"error",message:"请输入验证码",showClose:!0});C(d.value.captchaId,d.value.captchaType,d.value.CaptChaValue)}let e=o.value,a=await U(e.User,e.PassWord,e.superPassWord);1e4===a.Status&&(t.value="登录"),1e4===返回.Status&&l({type:"success",message:a.Msg,showClose:!0}),await L()},L=async()=>{let e=await g(1);1e4===e.Status&&(s.value=e.Data.CaptChaImg,d.value.captchaId=e.Data.CaptchaId,d.value.CaptChaValue="")};D((async()=>{await W()}));const W=async()=>{localStorage.setItem("kyToken","");let e=await f();1e4===e.Status&&(localStorage.setItem("kyToken",e.Data.Token),localStorage.setItem("CryptoKeyAes",e.Data.CryptoKeyAes),(async()=>{let e=await w();if(1e4===e.Status&&e.Data.length>2){let a=JSON.parse(e.Data);u.value.NewUserInfo=a.hasOwnProperty("NewUserInfo")?a.NewUserInfo:0,u.value.SetPassWord=a.hasOwnProperty("SetPassWord")?a.SetPassWord:0,u.value.UserLogin=a.hasOwnProperty("UserLogin")?a.UserLogin:0}})(),L())};return(e,l)=>{const m=i,h=p,f=v,g=r,w=n,C=c;return S(),x("div",Y,[R(h,{onChange:l[0]||(l[0]=e=>a.value=!0),modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value=e),style:{"margin-bottom":"5px"}},{default:b((()=>[R(m,{label:"登录"}),R(m,{label:"注册"}),R(m,{label:"找回"}),R(m,{label:"充值"})])),_:1},8,["modelValue"]),a.value?M((S(),x("div",Z,[R(X)],512)),[[O,"充值"===t.value]]):G("",!0),M(R(C,{model:o.value},{default:b((()=>[R(g,{prop:"username"},{default:b((()=>[R(f,{modelValue:o.value.User,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.User=e),size:"large",placeholder:"请输入用户名","suffix-icon":"user"},null,8,["modelValue"])])),_:1}),R(g,{prop:"password"},{default:b((()=>[R(f,{modelValue:o.value.PassWord,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.PassWord=e),"show-password":"",size:"large",placeholder:"找回"===t.value?"请输入新密码":"请输入密码"},null,8,["modelValue","placeholder"])])),_:1}),"找回"===t.value||"注册"===t.value?(S(),k(g,{key:0,prop:"password"},{default:b((()=>[R(f,{modelValue:o.value.superPassWord,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.superPassWord=e),"show-password":"",size:"large",placeholder:"请输入超级密码"},null,8,["modelValue"])])),_:1})):G("",!0),"注册"===t.value?(S(),k(g,{key:1,prop:"username"},{default:b((()=>[R(f,{modelValue:o.value.Qq,"onUpdate:modelValue":l[5]||(l[5]=e=>o.value.Qq=e),size:"large",placeholder:"请输入联系QQ"},null,8,["modelValue"])])),_:1})):G("",!0),"登录"===t.value&&1===u.value.UserLogin||"注册"===t.value&&1===u.value.NewUserInfo||"找回"===t.value&&1===u.value.SetPassWord?(S(),k(g,{key:2,prop:"captcha"},{default:b((()=>[Q("div",$,[R(f,{modelValue:d.value.CaptChaValue,"onUpdate:modelValue":l[6]||(l[6]=e=>d.value.CaptChaValue=e),placeholder:"请输入右侧验证码",size:"large",style:{flex:"1","padding-right":"20px",width:"40%"}},null,8,["modelValue"]),Q("img",{style:{width:"30%",height:"30Px",padding:"0",margin:"0"},src:s.value,alt:"请输入验证码",onClick:l[7]||(l[7]=e=>L())},null,8,ee)])])),_:1})):G("",!0),R(g,null,{default:b((()=>[R(w,{type:"primary",size:"large",style:{width:"100%","margin-left":"0"},onClick:y},{default:b((()=>[N(z(t.value),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),[[O,"充值"!==t.value]])])}}},[["__scopeId","data-v-8e874c49"]]);export{ae as default};
